{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{380:function(a,t,r){\"use strict\";r.r(t);var _=r(23),e=Object(_.a)({},(function(){var a=this,t=a.$createElement,r=a._self._c||t;return r(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":a.$parent.slotKey}},[r(\"h1\",{attrs:{id:\"sql优化\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#sql优化\"}},[a._v(\"#\")]),a._v(\" SQL优化\")]),a._v(\" \"),r(\"h2\",{attrs:{id:\"_1-为什么要优化\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1-为什么要优化\"}},[a._v(\"#\")]),a._v(\" 1.为什么要优化\")]),a._v(\" \"),r(\"p\",[a._v(\"随着业务数据量的增多，SQL的执行效率对程序的运行效率的影响逐渐增大\")]),a._v(\" \"),r(\"h2\",{attrs:{id:\"_2-优化方法\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-优化方法\"}},[a._v(\"#\")]),a._v(\" 2.优化方法\")]),a._v(\" \"),r(\"h3\",{attrs:{id:\"_2-1对查询进行优化\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-1对查询进行优化\"}},[a._v(\"#\")]),a._v(\" 2.1对查询进行优化\")]),a._v(\" \"),r(\"p\",[a._v(\"尽量避免全表扫描，首先应考虑在 where 及 order by 涉及的列上建立索引\")]),a._v(\" \"),r(\"h3\",{attrs:{id:\"_2-2避免在where子句判断null\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-2避免在where子句判断null\"}},[a._v(\"#\")]),a._v(\" 2.2避免在where子句判断null\")]),a._v(\" \"),r(\"p\",[a._v(\"会导致不使用索引而进行全表扫描，如果需要判断null，建议在此列设置默认值0，确保表中此列没有null值，\")]),a._v(\" \"),r(\"p\",[a._v(\"然后where column = 0\")]),a._v(\" \"),r(\"h3\",{attrs:{id:\"_2-3避免在where子句使用-或\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-3避免在where子句使用-或\"}},[a._v(\"#\")]),a._v(\" 2.3避免在where子句使用 != 或<>\")]),a._v(\" \"),r(\"p\",[a._v(\"会导致不使用索引而进行全表扫描\")]),a._v(\" \"),r(\"h3\",{attrs:{id:\"_2-4避免在where子句使用or\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-4避免在where子句使用or\"}},[a._v(\"#\")]),a._v(\" 2.4避免在where子句使用or\")]),a._v(\" \"),r(\"p\",[a._v(\"会导致不使用索引而进行全表扫描，建议使用union all\")]),a._v(\" \"),r(\"p\",[a._v(\"使用or的话如果or条件的每个列都加上索引，就会走索引，如果or多个列有的列没有索引那么不会走索引\")]),a._v(\" \"),r(\"h3\",{attrs:{id:\"_2-5-in-和-not-in-也要慎用\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-5-in-和-not-in-也要慎用\"}},[a._v(\"#\")]),a._v(\" 2.5 in 和 not in 也要慎用\")]),a._v(\" \"),r(\"p\",[a._v(\"对于连续的数值，能用 between 就不要用 in 了\")]),a._v(\" \"),r(\"h3\",{attrs:{id:\"_2-6-like查询使用\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-6-like查询使用\"}},[a._v(\"#\")]),a._v(\" 2.6 LIKE查询使用 '%***%'\")]),a._v(\" \"),r(\"p\",[a._v(\"全模糊查询是不走索引的,但是只用一个%是会走索引的\")]),a._v(\" \"),r(\"p\",[a._v(\"会导致不使用索引而进行全表扫描\")]),a._v(\" \"),r(\"h3\",{attrs:{id:\"_2-7避免在where子句对字段进行表达式操作\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-7避免在where子句对字段进行表达式操作\"}},[a._v(\"#\")]),a._v(\" 2.7避免在where子句对字段进行表达式操作\")]),a._v(\" \"),r(\"p\",[a._v(\"select id from t where num/2=100\")]),a._v(\" \"),r(\"p\",[a._v(\"应改为:\")]),a._v(\" \"),r(\"p\",[a._v(\"select id from t where num=100*2\")]),a._v(\" \"),r(\"h3\",{attrs:{id:\"_2-8避免在where子句对字段进行函数操作\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-8避免在where子句对字段进行函数操作\"}},[a._v(\"#\")]),a._v(\" 2.8避免在where子句对字段进行函数操作\")]),a._v(\" \"),r(\"p\",[a._v(\"select id from t where substring(name,1,3)='abc'--name以abc开头的id\")]),a._v(\" \"),r(\"p\",[a._v(\"应改为:\")]),a._v(\" \"),r(\"p\",[a._v(\"select id from t where name like 'abc%'\")]),a._v(\" \"),r(\"h3\",{attrs:{id:\"_2-9避免在where子句中的-左边进行函数、算术运算或其他表达式运算\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-9避免在where子句中的-左边进行函数、算术运算或其他表达式运算\"}},[a._v(\"#\")]),a._v(' 2.9避免在where子句中的 \"=\" 左边进行函数、算术运算或其他表达式运算')]),a._v(\" \"),r(\"p\",[a._v(\"否则系统将可能无法正确使用索引\")]),a._v(\" \"),r(\"h3\",{attrs:{id:\"_2-10复合索引需要查询条件顺序一致\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-10复合索引需要查询条件顺序一致\"}},[a._v(\"#\")]),a._v(\" 2.10复合索引需要查询条件顺序一致\")]),a._v(\" \"),r(\"h3\",{attrs:{id:\"_2-11不要写一些没有意义的查询\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-11不要写一些没有意义的查询\"}},[a._v(\"#\")]),a._v(\" 2.11不要写一些没有意义的查询\")]),a._v(\" \"),r(\"h3\",{attrs:{id:\"_2-12用exists-代替-in-是一个好的选择\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-12用exists-代替-in-是一个好的选择\"}},[a._v(\"#\")]),a._v(\" 2.12用exists 代替 in 是一个好的选择\")]),a._v(\" \"),r(\"p\",[a._v(\"select num from a where num in(select num from b)\")]),a._v(\" \"),r(\"p\",[a._v(\"用下面的语句替换：\")]),a._v(\" \"),r(\"p\",[a._v(\"select num from a where exists(select 1 from b where num=a.num)\")]),a._v(\" \"),r(\"h3\",{attrs:{id:\"_2-13索引列有大量重复数据\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-13索引列有大量重复数据\"}},[a._v(\"#\")]),a._v(\" 2.13索引列有大量重复数据\")]),a._v(\" \"),r(\"p\",[a._v(\"SQL是根据表中数据来进行查询优化的，当索引列有大量数据重复时，建了索引也对查询效率起不了作用\")]),a._v(\" \"),r(\"h3\",{attrs:{id:\"_2-14索引并不是越多越好\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-14索引并不是越多越好\"}},[a._v(\"#\")]),a._v(\" 2.14索引并不是越多越好\")]),a._v(\" \"),r(\"p\",[a._v(\"索引固然可以提高相应的 select 的效率，但同时也降低了 insert 及 update 的效率，因为 insert 或 update 时有可能会重建索引，所以怎样建索引需要慎重考虑，视具体情况而定。\")]),a._v(\" \"),r(\"p\",[a._v(\"一个表的索引数最好不要超过6个，若太多则应考虑一些不常使用到的列上建的索引是否有必要.\")]),a._v(\" \"),r(\"h3\",{attrs:{id:\"_2-15尽量使用数字型字段\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-15尽量使用数字型字段\"}},[a._v(\"#\")]),a._v(\" 2.15尽量使用数字型字段\")]),a._v(\" \"),r(\"p\",[a._v(\"若只含数值信息的字段尽量不要设计为字符型，这会降低查询和连接的性能，并会增加存储开销。\")]),a._v(\" \"),r(\"p\",[a._v(\"这是因为引擎在处理查询和连接时会逐个比较字符串中每一个字符，而对于数字型而言只需要比较一次就够了。\")]),a._v(\" \"),r(\"h3\",{attrs:{id:\"_2-16使用-varchar-代替-char\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-16使用-varchar-代替-char\"}},[a._v(\"#\")]),a._v(\" 2.16使用 varchar 代替 char\")]),a._v(\" \"),r(\"p\",[a._v(\"变长字段存储空间小，可以节省存储空间，其次对于查询来说，在一个相对较小的字段内搜索效率显然要高些\")]),a._v(\" \"),r(\"h3\",{attrs:{id:\"_2-17-不要使用-select\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-17-不要使用-select\"}},[a._v(\"#\")]),a._v(\" 2.17   不要使用 select  *\")]),a._v(\" \"),r(\"p\",[a._v(\"用具体的字段列表代替“*”，不要返回用不到的任何字段\")]),a._v(\" \"),r(\"h3\",{attrs:{id:\"_2-18-避免频繁创建和删除临时表\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-18-避免频繁创建和删除临时表\"}},[a._v(\"#\")]),a._v(\" 2.18 避免频繁创建和删除临时表\")]),a._v(\" \"),r(\"p\",[a._v(\"减少系统表资源的消耗\")]),a._v(\" \"),r(\"h3\",{attrs:{id:\"_2-19适当使用临时表\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-19适当使用临时表\"}},[a._v(\"#\")]),a._v(\" 2.19适当使用临时表\")]),a._v(\" \"),r(\"p\",[a._v(\"临时表并不是不可使用，适当地使用它们可以使某些例程更有效，例如，当需要重复引用大型表或常用表中的某个数据集时。但是，对于一次性事件，最好使用导出表。\")]),a._v(\" \"),r(\"h3\",{attrs:{id:\"_2-20新建数据大的临时表\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-20新建数据大的临时表\"}},[a._v(\"#\")]),a._v(\" 2.20新建数据大的临时表\")]),a._v(\" \"),r(\"p\",[a._v(\"如果一次性插入数据量很大，那么可以使用 select into 代替 create table，避免造成大量 log ，以提高速度；如果数据量不大，为了缓和系统表的资源，应先create table，然后insert。\")]),a._v(\" \"),r(\"h3\",{attrs:{id:\"_2-21使用临时表需要删除\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-21使用临时表需要删除\"}},[a._v(\"#\")]),a._v(\" 2.21使用临时表需要删除\")]),a._v(\" \"),r(\"p\",[a._v(\"如果使用到了临时表，在存储过程的最后务必将所有的临时表显式删除，先 truncate table ，然后 drop table ，这样可以避免系统表的较长时间锁定。\")]),a._v(\" \"),r(\"h3\",{attrs:{id:\"_2-22尽量避免使用游标\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-22尽量避免使用游标\"}},[a._v(\"#\")]),a._v(\" 2.22尽量避免使用游标\")]),a._v(\" \"),r(\"p\",[a._v(\"因为游标的效率较差，如果游标操作的数据超过1万行，那么就应该考虑改写。\")]),a._v(\" \"),r(\"h3\",{attrs:{id:\"_2-23-使用游标最好用使用集替换\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-23-使用游标最好用使用集替换\"}},[a._v(\"#\")]),a._v(\" 2.23 使用游标最好用使用集替换\")]),a._v(\" \"),r(\"p\",[a._v(\"使用基于游标的方法或临时表方法之前，应先寻找基于集的解决方案来解决问题，基于集的方法通常更有效。\")]),a._v(\" \"),r(\"h3\",{attrs:{id:\"_2-24使用游标\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-24使用游标\"}},[a._v(\"#\")]),a._v(\" 2.24使用游标\")]),a._v(\" \"),r(\"p\",[a._v(\"与临时表一样，游标并不是不可使用。对小型数据集使用 FAST_FORWARD 游标通常要优于其他逐行处理方法，尤其是在必须引用几个表才能获得所需的数据时。在结果集中包括“合计”的例程通常要比使用游标执行的速度快。如果开发时间允许，基于游标的方法和基于集的方法都可以尝试一下，看哪一种方法的效果更好。\")]),a._v(\" \"),r(\"h3\",{attrs:{id:\"_2-25尽量避免大事务操作\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-25尽量避免大事务操作\"}},[a._v(\"#\")]),a._v(\" 2.25尽量避免大事务操作\")]),a._v(\" \"),r(\"p\",[a._v(\"提高系统并发能力。\")]),a._v(\" \"),r(\"h3\",{attrs:{id:\"_2-26尽量避免向客户端返回大数据量\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-26尽量避免向客户端返回大数据量\"}},[a._v(\"#\")]),a._v(\" 2.26尽量避免向客户端返回大数据量\")]),a._v(\" \"),r(\"p\",[a._v(\"若数据量过大，应该考虑相应需求是否合理。\")])])}),[],!1,null,null,null);t.default=e.exports}}]);","extractedComments":[]}
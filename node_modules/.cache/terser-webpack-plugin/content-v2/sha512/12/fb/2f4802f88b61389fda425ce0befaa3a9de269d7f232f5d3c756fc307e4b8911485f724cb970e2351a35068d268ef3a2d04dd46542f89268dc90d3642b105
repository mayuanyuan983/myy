{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[166],{197:function(e,r,t){\"use strict\";t.r(r);var n=t(3),a=Object(n.a)({},(function(){var e=this,r=e.$createElement,t=e._self._c||r;return t(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":e.$parent.slotKey}},[t(\"h1\",{attrs:{id:\"公众号-小程序推送\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#公众号-小程序推送\"}},[e._v(\"#\")]),e._v(\" 公众号/小程序推送\")]),e._v(\" \"),t(\"h2\",{attrs:{id:\"_1-查询微信粉丝数目和接口调用次数\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1-查询微信粉丝数目和接口调用次数\"}},[e._v(\"#\")]),e._v(\" 1.查询微信粉丝数目和接口调用次数\")]),e._v(\" \"),t(\"p\",[e._v(\"可以在【微信公众平台（\"),t(\"a\",{attrs:{href:\"https://mp.weixin.qq.com/\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"https://mp.weixin.qq.com/\"),t(\"OutboundLink\")],1),e._v(\"）】中的【管理】-【用户管理】里查询粉丝数目，在【开发】-【接口权限】里查询每日接口调用次数限制\")]),e._v(\" \"),t(\"img\",{staticStyle:{zoom:\"60%\"},attrs:{src:e.$withBase(\"/img/qC1NoNMfvu1YwTvq.png\"),alt:\"dock\"}}),e._v(\" \"),t(\"h2\",{attrs:{id:\"_2-如何拿到公众号的-openid-及-unionid\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-如何拿到公众号的-openid-及-unionid\"}},[e._v(\"#\")]),e._v(\" 2.如何拿到公众号的 OPENID 及 UNIONID\")]),e._v(\" \"),t(\"h3\",{attrs:{id:\"_1-首先将公众号-小程序全部绑定在同一个开放平台下\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1-首先将公众号-小程序全部绑定在同一个开放平台下\"}},[e._v(\"#\")]),e._v(\" 1.首先将公众号-小程序全部绑定在同一个开放平台下\")]),e._v(\" \"),t(\"p\",[e._v(\"微信开放平台地址：\"),t(\"a\",{attrs:{href:\"open.weixin.qq.com\"}},[e._v(\"open.weixin.qq.com\")])]),e._v(\" \"),t(\"h3\",{attrs:{id:\"_2-获取-a-公众号的所有粉丝的-openid-存入数据库表中-每日-500-次-一次一万-【无后台的公众号-如果之前有存对应信息可以不用此步骤】\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-获取-a-公众号的所有粉丝的-openid-存入数据库表中-每日-500-次-一次一万-【无后台的公众号-如果之前有存对应信息可以不用此步骤】\"}},[e._v(\"#\")]),e._v(\" 2.获取 A 公众号的所有粉丝的 OPENID 存入数据库表中（每日 500 次，一次一万）【无后台的公众号，如果之前有存对应信息可以不用此步骤】\")]),e._v(\" \"),t(\"p\",[t(\"strong\",[e._v(\"【问题】如果公众号以后不使用后台存储用户信息，以后不是要每天都去调接口去获取用户列表？\")])]),e._v(\" \"),t(\"p\",[e._v(\"接口：\"),t(\"a\",{attrs:{href:\"https://developers.weixin.qq.com/doc/offiaccount/User_Management/Getting_a_User_List.html\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"https://developers.weixin.qq.com/doc/offiaccount/User_Management/Getting_a_User_List.html\"),t(\"OutboundLink\")],1)]),e._v(\" \"),t(\"p\",[e._v(\"当公众号关注者数量超过 10000 时，可通过填写 next_openid 的值，从而多次拉取列表的方式来满足需求。\")]),e._v(\" \"),t(\"h4\",{attrs:{id:\"_3-根据openid获取对应的unionid更新数据库表-每日500000次\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-根据openid获取对应的unionid更新数据库表-每日500000次\"}},[e._v(\"#\")]),e._v(\" ３.根据OPENID获取对应的UNIONID更新数据库表（每日500000次）\")]),e._v(\" \"),t(\"p\",[e._v(\"接口：\"),t(\"a\",{attrs:{href:\"https://developers.weixin.qq.com/doc/offiaccount/User_Management/Get_users_basic_information_UnionID.html#UinonId\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"https://developers.weixin.qq.com/doc/offiaccount/User_Management/Get_users_basic_information_UnionID.html#UinonId\"),t(\"OutboundLink\")],1)]),e._v(\" \"),t(\"p\",[e._v(\"可以单个获取,可以批量:最多支持一次拉取 100 条。\")]),e._v(\" \"),t(\"p\",[e._v(\"可以根据 OPENID 拿到用户是否关注公众号,以及绑定了开放平台可以拿到 unionid 字段\")]),e._v(\" \"),t(\"h4\",{attrs:{id:\"_4-另一个公众号即可根据unionid查询数据库表拿到另一个公众号的openid\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_4-另一个公众号即可根据unionid查询数据库表拿到另一个公众号的openid\"}},[e._v(\"#\")]),e._v(\" ４.另一个公众号即可根据UNIONID查询数据库表拿到另一个公众号的OPENID\")]),e._v(\" \"),t(\"h4\",{attrs:{id:\"_5-小程序-unionid-获取途径\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_5-小程序-unionid-获取途径\"}},[e._v(\"#\")]),e._v(\" 5.小程序 UnionID 获取途径:\")]),e._v(\" \"),t(\"p\",[e._v(\"绑定了开发者帐号的小程序，可以通过以下途径获取 UnionID。\")]),e._v(\" \"),t(\"ol\",[t(\"li\",[e._v(\"调用接口\"),t(\"a\",{attrs:{href:\"https://developers.weixin.qq.com/miniprogram/dev/api/open-api/user-info/wx.getUserInfo.html\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"wx.getUserInfo\"),t(\"OutboundLink\")],1),e._v(\"，从解密数据中获取 UnionID。注意本接口需要用户授权，请开发者妥善处理用户拒绝授权后的情况。\")]),e._v(\" \"),t(\"li\",[e._v(\"如果开发者帐号下存在\"),t(\"strong\",[e._v(\"同主体的\")]),e._v(\"公众号，并且该用户已经关注了该公众号。开发者可以直接通过\"),t(\"a\",{attrs:{href:\"https://developers.weixin.qq.com/miniprogram/dev/api/open-api/login/wx.login.html\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"wx.login\"),t(\"OutboundLink\")],1),e._v(\"+\"),t(\"code\",[e._v(\"code2Session\")]),e._v(\"获取到该用户 UnionID，无须用户再次授权。\")]),e._v(\" \"),t(\"li\",[e._v(\"如果开发者帐号下存在\"),t(\"strong\",[e._v(\"同主体的\")]),e._v(\"公众号或移动应用，并且该用户已经授权登录过该公众号或移动应用。开发者也可以直接通过\"),t(\"a\",{attrs:{href:\"https://developers.weixin.qq.com/miniprogram/dev/api/open-api/login/wx.login.html\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"wx.login\"),t(\"OutboundLink\")],1),e._v(\"+\"),t(\"code\",[e._v(\"code2Session\")]),e._v(\"获取到该用户 UnionID，无须用户再次授权。\")]),e._v(\" \"),t(\"li\",[e._v(\"用户在小程序（暂不支持小游戏）中支付完成后，开发者可以直接通过\"),t(\"code\",[e._v(\"getPaidUnionId\")]),e._v(\"接口获取该用户的 UnionID，无需用户授权。注意：本接口仅在用户支付完成后的 5 分钟内有效，请开发者妥善处理。\")]),e._v(\" \"),t(\"li\",[e._v(\"小程序端调用\"),t(\"a\",{attrs:{href:\"https://developers.weixin.qq.com/miniprogram/dev/wxcloud/basis/capabilities.html#%E4%BA%91%E5%87%BD%E6%95%B0\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"云函数\"),t(\"OutboundLink\")],1),e._v(\"时，如果开发者帐号下存在\"),t(\"strong\",[e._v(\"同主体的\")]),e._v(\"公众号，并且该用户已经关注了该公众号，可在云函数中通过\"),t(\"a\",{attrs:{href:\"https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-server-api/utils/getWXContext.html\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"cloud.getWXContext\"),t(\"OutboundLink\")],1),e._v(\"获取 UnionID。\")]),e._v(\" \"),t(\"li\",[e._v(\"小程序端调用\"),t(\"a\",{attrs:{href:\"https://developers.weixin.qq.com/miniprogram/dev/wxcloud/basis/capabilities.html#%E4%BA%91%E5%87%BD%E6%95%B0\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"云函数\"),t(\"OutboundLink\")],1),e._v(\"时，如果开发者帐号下存在\"),t(\"strong\",[e._v(\"同主体的\")]),e._v(\"公众号或移动应用，并且该用户已经授权登录过该公众号或移动应用，也可在云函数中通过\"),t(\"a\",{attrs:{href:\"https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-server-api/utils/getWXContext.html\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"cloud.getWXContext\"),t(\"OutboundLink\")],1),e._v(\"获取 UnionID\")])]),e._v(\" \"),t(\"h2\",{attrs:{id:\"_3-公众号推送模板消息\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-公众号推送模板消息\"}},[e._v(\"#\")]),e._v(\" 3.公众号推送模板消息\")]),e._v(\" \"),t(\"p\",[e._v(\"需要模板 ID，接收人 OPENID\")]),e._v(\" \"),t(\"p\",[t(\"a\",{attrs:{href:\"https://developers.weixin.qq.com/doc/offiaccount/Message_Management/Template_Message_Interface.html\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"https://developers.weixin.qq.com/doc/offiaccount/Message_Management/Template_Message_Interface.html\"),t(\"OutboundLink\")],1)]),e._v(\" \"),t(\"h2\",{attrs:{id:\"_4-小程序推送订阅消息\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_4-小程序推送订阅消息\"}},[e._v(\"#\")]),e._v(\" 4.小程序推送订阅消息\")]),e._v(\" \"),t(\"p\",[t(\"a\",{attrs:{href:\"https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/subscribe-message.html\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/subscribe-message.html\"),t(\"OutboundLink\")],1)]),e._v(\" \"),t(\"h3\",{attrs:{id:\"步骤一-获取模板-id\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#步骤一-获取模板-id\"}},[e._v(\"#\")]),e._v(\" 步骤一：获取模板 ID\")]),e._v(\" \"),t(\"p\",[e._v(\"在微信公众平台手动配置获取模板 ID：\")]),e._v(\" \"),t(\"p\",[e._v(\"登录\"),t(\"a\",{attrs:{href:\"https://mp.weixin.qq.com/\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"https://mp.weixin.qq.com\"),t(\"OutboundLink\")],1),e._v(\"获取模板，如果没有合适的模板，可以申请添加新模板，审核通过后可使用。\")]),e._v(\" \"),t(\"h3\",{attrs:{id:\"步骤二-获取下发权限\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#步骤二-获取下发权限\"}},[e._v(\"#\")]),e._v(\" 步骤二：获取下发权限\")]),e._v(\" \"),t(\"p\",[e._v(\"详见小程序端消息订阅接口\"),t(\"a\",{attrs:{href:\"https://developers.weixin.qq.com/miniprogram/dev/api/open-api/subscribe-message/wx.requestSubscribeMessage.html\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"https://developers.weixin.qq.com/miniprogram/dev/api/open-api/subscribe-message/wx.requestSubscribeMessage.html\"),t(\"OutboundLink\")],1)]),e._v(\" \"),t(\"h3\",{attrs:{id:\"步骤三-调用接口下发订阅消息\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#步骤三-调用接口下发订阅消息\"}},[e._v(\"#\")]),e._v(\" 步骤三：调用接口下发订阅消息\")]),e._v(\" \"),t(\"p\",[e._v(\"详见服务端消息发送接口\"),t(\"a\",{attrs:{href:\"https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/subscribe-message/subscribeMessage.send.html\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"subscribeMessage.send\"),t(\"OutboundLink\")],1)]),e._v(\" \"),t(\"h3\",{attrs:{id:\"注意事项\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#注意事项\"}},[e._v(\"#\")]),e._v(\" 注意事项\")]),e._v(\" \"),t(\"ul\",[t(\"li\",[e._v(\"用户勾选 “总是保持以上选择，不再询问” 之后，下次订阅调用 wx.requestSubscribeMessage 不会弹窗，保持之前的选择，修改选择需要打开小程序设置进行修改。\")])]),e._v(\" \"),t(\"h2\",{attrs:{id:\"_5-小程序统一公共消息-使用小程序给公众号发送消息-可以不用拿到公众号的-openid-要求与小程序有绑定且同主体\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_5-小程序统一公共消息-使用小程序给公众号发送消息-可以不用拿到公众号的-openid-要求与小程序有绑定且同主体\"}},[e._v(\"#\")]),e._v(\" 5.小程序统一公共消息（使用小程序给公众号发送消息）可以不用拿到公众号的 OPENID，要求与小程序有绑定且同主体\")]),e._v(\" \"),t(\"p\",[e._v(\"调用这个接口的前提是公众号和小程序\"),t(\"strong\",[e._v(\"有绑定且是同主体的\")])]),e._v(\" \"),t(\"p\",[e._v(\"登录公众号后台 -> 小程序 -> 小程序管理 -> 添加即可绑定小程序\")]),e._v(\" \"),t(\"p\",[e._v(\"因为实质上还是发的公众号模板消息，所以还是要在公众号后台添加消息模板获取模板 id\")]),e._v(\" \"),t(\"p\",[t(\"a\",{attrs:{href:\"https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/uniform-message/uniformMessage.send.html\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/uniform-message/uniformMessage.send.html\"),t(\"OutboundLink\")],1)]),e._v(\" \"),t(\"p\",[e._v(\"这个接口可以发送公众号或者小程序的消息。之前大家都知道，我们用小程序发送消息，有小程序的 api 接口，如果是发送公众号的消息，就有公众号的模板消息接口。\")]),e._v(\" \"),t(\"p\",[e._v(\"access_token 小程序的 access_token   这个一定要用小程序的 accesstoken，不能使用公众号的，因为这个接口的初衷就是想大家在开发小程序的时候，\"),t(\"strong\",[e._v(\"如果要发送公众号消息直接使用这个接口就可以了，无需再去调用公众号的模板消息接口\")]),e._v(\"。\")]),e._v(\" \"),t(\"p\",[e._v(\"touser 用户 openid，可以是小程序的 openid，也可以是 mp_template_msg.appid 对应的公众号的 openid\")]),e._v(\" \"),t(\"p\",[e._v(\"这个\"),t(\"strong\",[e._v(\"使用公众号的 openid 或者小程序的 openid 都可以的\")]),e._v(\"微信官方会自动关联。其实大家的使用场景大部分还是在小程序，所以这里你就直接用小程序里抓到的 openid 就可以了。\")]),e._v(\" \"),t(\"p\",[e._v(\"mp_template_msg.appid 公众号 appid，要求与小程序有绑定且同主体      这个大家要仔细读官方的说明哦，就是这公众号和小程序要相互关联了，且必须是同主体才行。不然也会调试不通过的。\")])])}),[],!1,null,null,null);r.default=a.exports}}]);","extractedComments":[]}
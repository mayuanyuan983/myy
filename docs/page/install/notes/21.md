# Linux 下vsftp安装说明

## 安装FTP服务

1. 上传vsftpd-3.0.2-28.el7.x86_64.rpm文件到目录
2. 执行安装命令：`rpm -ivh vsftpd-3.0.2-28.el7.x86_64.rpm`
3. FTP服务自启动：`systemctl enable vsftpd`
4. 开启FTP服务：`systemctl start vsftpd`
5. 停止FTP服务：`systemctl stop vsftpd`
6. 重启FTP服务：`systemctl restart vsftpd`
7. 查看FTP服务状态：`systemctl status vsftpd`

## FTP两种模式说明

### 被动模式：

客户端一般不需要设置防火墙，服务器需要开启21端口准入，并设置被动模式数据端口范围P，并在防火墙中开启P的准入

### 主动模式：

1. 服务器没有“物理防火墙”的情况下，只需要在服务器操作系统中开启21端口的准入，20端口的准出默认是允许的（Windows系统防火墙默认是不拦截“准出”的）。
2. 服务器有“物理防火墙”的情况下，需要在“物理防火墙”中开启21端口的准入，20端口的准出。
3. 客户端需要设置“允许应用程序通过防火墙”（WinSCP.exe、FlashFXP等）

## FTP被动模式配置

1. 修改配置文件：`vim /etc/vsftpd/vsftpd.conf`

   1. 被动模式端口：

   ```bash
   pasv_enable=YES #被动模式开启#在linux上，如果不配置pasv_enable=NO，默认是passive模式
   # 被动模式传输使用端口
   #设定在PASV模式下，建立数据传输所可以使用port范围的下界和上界，0 表示任意(1024 – 65535端口)。默认值为0。
   pasvrt=5555
   pasv_max_port=6666
   ```

2. 如果服务器有防火墙需要开被动模式端口范围的准入

3. 限制所有用户登录FTP时都只能访问主目录，不能向上访问

   ```bash
   chroot_local_user=YES
   chroot_list_enable=NO
   allow_writeable_chroot=YES
   ```

4. 查看FTP创建文件及文件夹的权限，如果没有权限则无法创建文件和文件夹

```bash
#执行命令
getsebool -a|grep ftp
```

​	展示如下

```bash
allow_ftpd_anon_write --> on   
allow_ftpd_full_access --> on //创建文件及文件夹  
allow_ftpd_use_cifs --> off  
allow_ftpd_use_nfs --> off  
ftp_home_dir --> on //显示文件夹及文件  
ftpd_connect_db --> off  
ftpd_use_passive_mode --> off  
```

​	allow_ftpd_full_access如果是off，运行如下指令

```bash
#执行命令
setsebool allow_ftpd_full_access=1  
```

5. 新建FTP用户
   1. 创建用户：`useradd ftpuser`
   2. 添加密码：`passwd ftpuser` 输入密码 `ftpuser`
   3. 禁止SSH登录：`usermod -s /usr/sbin/nologin ftpuser`

